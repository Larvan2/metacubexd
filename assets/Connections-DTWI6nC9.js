import{u as le,f as l,N as Pe,S as ke,i as s,O as oe,P as Te,t as g,b as De,y as Ge,A as _,Q as Ee,R as Z,T as o,U as Ke,B as F,V as X,I as Y,W as J,H as T,X as z,Y as W,Z as ee,_ as Re,r as Me,w as ze,D as $,g as x,$ as w,a0 as I,a1 as te,E as Ne,a2 as Oe,a3 as He,a4 as Ae,a5 as Ve,F as D,a6 as N,a7 as ae,a8 as ne,a9 as je,aa as Ue,ab as Le,ac as Qe,ad as qe,ae as Be,af as Ze,ag as Xe,l as Ye}from"./index-DDLXS1hp.js";import{c as Je,g as We,a as et,b as tt,d as at,e as nt,f as G,r as rt}from"./index-D-uU0qjo.js";import{f as st}from"./global-BSE-9LQI.js";var lt=g("<pre><code>");const ot=d=>{const[b]=le();return l(Te,{ref:m=>{var n;return(n=d.ref)==null?void 0:n.call(d,m)},get icon(){return l(Pe,{size:24})},get title(){return b("connectionsDetails")},get children(){return l(ke,{get when(){return d.selectedConnectionID},get children(){var m=lt(),n=m.firstChild;return s(n,()=>JSON.stringify(oe().find(({id:C})=>C===d.selectedConnectionID),null,2)),m}})}})};var it=async d=>{typeof d=="string"?await navigator.clipboard.writeText(d):await navigator.clipboard.write(d)},re=g('<div class="flex h-4 items-center">'),ct=g('<div class="max-w-[200px] overflow-hidden text-ellipsis whitespace-nowrap">'),dt=g('<div class="flex h-full flex-col gap-2"><div class="flex w-full flex-wrap items-center gap-2"><div class="flex items-center gap-2"><div class="tabs-boxed tabs gap-2"></div><div class="flex items-center"><span class="mr-2 hidden lg:inline-block">:</span><input type=checkbox class=toggle></div><select class="select select-bordered select-primary select-sm w-full max-w-full flex-1"><option value=""></option></select></div><div class="join flex flex-1 items-center md:flex-1"><input type=search class="input input-sm join-item input-primary min-w-0 flex-1"></div></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),ut=g('<button><span></span><div class="badge badge-sm">'),gt=g("<option>"),mt=g("<tr>"),pt=g("<th class=bg-base-200><div><div>"),bt=g("<button class=cursor-pointer>"),ft=g('<tr class="hover:!bg-primary hover:text-primary-content">'),ht=g("<td class=py-2>"),vt=g("<button><div></div><div></div><div>(<!>)");const se=(d,b,m,n)=>{const C=rt(d.getValue(b),m);return n({itemRank:C}),C.passed},_t=()=>{const d=De();if(!Ge())return d("/setup",{replace:!0}),null;let b,m;const[n]=le(),[C,ie]=_(0),{activeConnections:O,closedConnections:H,paused:ce,setPaused:de}=Ee(),[ue,A]=_(""),[V,ge]=Z(_(!1),{name:"enableQuickFilter",storage:localStorage}),[me,pe]=_(),be=[{header:()=>n("details"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:o.Details,cell:({row:e})=>(()=>{var a=re();return s(a,l(F,{class:"btn-circle btn-xs",onClick:()=>{pe(e.original.id),m==null||m.showModal()},get icon(){return l(Ke,{size:"16"})}})),a})()},{header:()=>n("close"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:o.Close,cell:({row:e})=>(()=>{var a=re();return s(a,l(F,{class:"btn-circle btn-xs",onClick:()=>X(e.original.id),get icon(){return l(Y,{size:"16"})}})),a})()},{header:()=>n("ID"),enableGrouping:!1,accessorKey:o.ID,accessorFn:e=>e.id},{header:()=>n("type"),accessorKey:o.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{header:()=>n("process"),accessorKey:o.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>n("host"),accessorKey:o.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`,cell:({row:e})=>(()=>{var a=ct();return s(a,()=>e.getValue(o.Host)),a})()},{header:()=>n("sniffHost"),accessorKey:o.SniffHost,accessorFn:e=>e.metadata.sniffHost||"-"},{header:()=>n("rules"),accessorKey:o.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{header:()=>n("chains"),accessorKey:o.Chains,accessorFn:e=>{const a=e.chains;return a.length>1?`${a[a.length-1]} :: ${a[0]}`:a[0]}},{header:()=>n("connectTime"),enableGrouping:!1,accessorKey:o.ConnectTime,accessorFn:e=>st(e.start),sortingFn:(e,a)=>J(e.original.start).valueOf()-J(a.original.start).valueOf()},{header:()=>n("dlSpeed"),enableGrouping:!1,accessorKey:o.DlSpeed,accessorFn:e=>`${T(e.downloadSpeed)}/s`,sortingFn:(e,a)=>e.original.downloadSpeed-a.original.downloadSpeed},{header:()=>n("ulSpeed"),enableGrouping:!1,accessorKey:o.ULSpeed,accessorFn:e=>`${T(e.uploadSpeed)}/s`,sortingFn:(e,a)=>e.original.uploadSpeed-a.original.uploadSpeed},{header:()=>n("dl"),enableGrouping:!1,accessorKey:o.Download,accessorFn:e=>T(e.download),sortingFn:(e,a)=>e.original.download-a.original.download},{header:()=>n("ul"),enableGrouping:!1,accessorKey:o.Upload,accessorFn:e=>T(e.upload),sortingFn:(e,a)=>e.original.upload-a.original.upload},{header:()=>n("sourceIP"),accessorKey:o.SourceIP,accessorFn:e=>{const a=z().find(f=>f.sourceIP===e.metadata.sourceIP);return a?a.tagName:e.metadata.sourceIP}},{header:()=>n("sourcePort"),accessorKey:o.SourcePort,accessorFn:e=>e.metadata.sourcePort},{header:()=>n("destination"),accessorKey:o.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host},{header:()=>n("inboundUser"),accessorKey:o.InboundUser,accessorFn:e=>e.metadata.inboundUser||e.metadata.inboundName||e.metadata.inboundPort}],[fe,he]=_([]),[ve,$e]=Z(_([{id:o.ConnectTime,desc:!0}]),{name:"connectionsTableSorting",storage:localStorage}),y=Je({filterFns:{fuzzy:se},state:{get columnOrder(){return W()},get grouping(){return fe()},get sorting(){return ve()},get columnVisibility(){return ee()},get globalFilter(){return ue()}},get data(){const e=C()===0?O():H();if(e.sort((f,P)=>f.id.localeCompare(P.id)),!V())return e;const a=new RegExp(Re(),"i");return e.filter(f=>!a.test(f.chains.join("")))},sortDescFirst:!0,enableHiding:!0,columns:be,onGlobalFilterChange:A,globalFilterFn:se,onGroupingChange:he,onSortingChange:$e,getFilteredRowModel:We(),getSortedRowModel:et(),getExpandedRowModel:tt(),getGroupedRowModel:at(),getCoreRowModel:nt()}),E=y.getFlatHeaders().find(({id:e})=>e===o.SourceIP),[K,Ce]=_("");Me(ze(K,()=>{const e=z().find(a=>a.sourceIP===K());E==null||E.column.setFilterValue(e?e.tagName:K())}));const Se=$(()=>[{type:0,name:n("active"),count:O().length},{type:1,name:n("closed"),count:H().length}]);return(()=>{var e=dt(),a=e.firstChild,f=a.firstChild,P=f.firstChild,j=P.nextSibling,R=j.firstChild,_e=R.firstChild,U=R.nextSibling,M=j.nextSibling,xe=M.firstChild,k=f.nextSibling,L=k.firstChild,ye=a.nextSibling,Q=ye.firstChild,q=Q.firstChild,Fe=q.nextSibling;return s(P,l(te,{get each(){return Se()},children:t=>(()=>{var i=ut(),r=i.firstChild,h=r.nextSibling;return i.$$click=()=>ie(t().type),s(r,()=>t().name),s(h,()=>t().count),x(()=>w(i,I(C()===t().type&&"tab-active","tab-sm sm:tab-md tab gap-2 px-2"))),i})()})),s(R,()=>n("quickFilter"),_e),U.addEventListener("change",t=>ge(t.target.checked)),M.addEventListener("change",t=>Ce(t.target.value)),s(xe,()=>n("all")),s(M,l(te,{get each(){return Ne.uniq(oe().map(({metadata:{sourceIP:t}})=>{const i=z().find(r=>r.sourceIP===t);return i?i.tagName:t})).sort()},children:t=>(()=>{var i=gt();return s(i,t),x(()=>i.value=t()),i})()}),null),L.$$input=t=>A(t.target.value),s(k,l(F,{class:"btn btn-primary join-item btn-sm",onClick:()=>de(t=>!t),get icon(){return $(()=>!!ce())()?l(Oe,{}):l(He,{})}}),null),s(k,l(F,{class:"btn btn-primary join-item btn-sm",onClick:()=>{y.getState().globalFilter?y.getFilteredRowModel().rows.forEach(({original:t})=>X(t.id)):Ae()},get icon(){return l(Y,{})}}),null),s(k,l(F,{class:"btn btn-primary join-item btn-sm",onClick:()=>b==null?void 0:b.showModal(),get icon(){return l(Ve,{})}}),null),s(q,l(D,{get each(){return y.getHeaderGroups()},children:t=>(()=>{var i=mt();return s(i,l(D,{get each(){return t.headers},children:r=>(()=>{var h=pt(),v=h.firstChild,c=v.firstChild;return s(v,(()=>{var u=$(()=>!!r.column.getCanGroup());return()=>u()?(()=>{var p=bt();return N(p,"click",r.column.getToggleGroupingHandler(),!0),s(p,(()=>{var S=$(()=>!!r.column.getIsGrouped());return()=>S()?l(ae,{size:18}):l(ne,{size:18})})()),p})():null})(),c),N(c,"click",r.column.getToggleSortingHandler(),!0),s(c,()=>G(r.column.columnDef.header,r.getContext())),s(v,()=>({asc:l(je,{}),desc:l(Ue,{})})[r.column.getIsSorted()]??null,null),x(u=>{var p=I("flex items-center gap-2"),S=I(r.column.getCanSort()&&"cursor-pointer select-none","flex-1");return p!==u.e&&w(v,u.e=p),S!==u.t&&w(c,u.t=S),u},{e:void 0,t:void 0}),h})()})),i})()})),s(Fe,l(D,{get each(){return y.getRowModel().rows},children:t=>(()=>{var i=ft();return s(i,l(D,{get each(){return t.getVisibleCells()},children:r=>(()=>{var h=ht();return h.$$contextmenu=v=>{v.preventDefault();const c=r.renderValue();c&&it(c).catch(()=>{})},s(h,(()=>{var v=$(()=>!!r.getIsGrouped());return()=>v()?(()=>{var c=vt(),u=c.firstChild,p=u.nextSibling,S=p.nextSibling,we=S.firstChild,B=we.nextSibling;return B.nextSibling,N(c,"click",t.getToggleExpandedHandler(),!0),s(u,(()=>{var Ie=$(()=>!!t.getIsExpanded());return()=>Ie()?l(ae,{size:18}):l(ne,{size:18})})()),s(p,()=>G(r.column.columnDef.cell,r.getContext())),s(S,()=>t.subRows.length,B),x(()=>w(c,I(t.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),c})():(()=>{var c=$(()=>!!r.getIsAggregated());return()=>c()?G(r.column.columnDef.aggregatedCell??r.column.columnDef.cell,r.getContext()):(()=>{var u=$(()=>!!r.getIsPlaceholder());return()=>u()?null:G(r.column.columnDef.cell,r.getContext())})()})()})()),h})()})),i})()})),s(e,l(qe,{ref:t=>b=t,get order(){return W()},get visible(){return ee()},onOrderChange:t=>Le(t),onVisibleChange:t=>Qe({...t})}),null),s(e,l(ot,{ref:t=>m=t,get selectedConnectionID(){return me()}}),null),x(t=>{var i=n("search"),r=I(Be(Ze()),"table table-zebra relative rounded-none");return i!==t.e&&Xe(L,"placeholder",t.e=i),r!==t.t&&w(Q,t.t=r),t},{e:void 0,t:void 0}),x(()=>U.checked=V()),e})()};Ye(["input","click","contextmenu"]);export{_t as default};
